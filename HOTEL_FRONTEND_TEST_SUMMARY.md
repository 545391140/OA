# 酒店预订功能前端测试总结

## 测试准备状态

### ✅ 代码构建状态
- **前端构建**: ✅ 成功（有警告但不影响功能）
- **后端服务**: ✅ 运行中（端口 3001）
- **前端服务**: ✅ 运行中（端口 3000）

### ✅ 组件检查
- ✅ `HotelSearchForm` - 已创建并导入
- ✅ `HotelList` - 已创建并导入
- ✅ `HotelDetail` - 已创建并导入
- ✅ `HotelBookingForm` - 已创建并导入
- ✅ `FlightSearch` - 已修改（添加 Tab 切换）
- ✅ 路由配置 - 已更新

### ✅ 服务检查
- ✅ `hotelService.js` - 已创建
- ✅ API 端点 - 已配置

## 快速测试步骤

### 1. 访问应用
```
http://localhost:3000/flight/search
```

### 2. 测试 Tab 切换
1. 打开页面，应该看到两个 Tab：
   - "机票预订"（默认选中）
   - "酒店预订"
2. 点击"酒店预订" Tab
3. 验证显示酒店搜索表单
4. 点击"机票预订" Tab
5. 验证显示机票搜索表单

### 3. 测试酒店搜索
1. 切换到"酒店预订" Tab
2. 填写搜索表单：
   - **城市**: 选择或输入 "NYC"（纽约）
   - **入住日期**: 选择未来30天的日期
   - **退房日期**: 选择入住日期后2天
   - **成人**: 1
   - **房间**: 1
3. 点击"搜索"按钮
4. 等待搜索结果
5. 验证显示酒店列表

### 4. 测试酒店详情
1. 在酒店列表中点击一个酒店卡片
2. 验证详情页显示：
   - 酒店名称
   - 地址
   - 价格
   - 评分（如果有）
   - "立即预订"按钮
3. 点击"返回"按钮
4. 验证返回到搜索页面

### 5. 测试预订流程（端到端）

#### 前置条件
确保至少有一个状态为 `approved` 或 `draft` 的差旅申请。

如果没有，先创建：
1. 访问差旅申请页面
2. 创建一个新的差旅申请
3. 审批通过（或保持草稿状态）

#### 步骤 1: 选择差旅申请
1. 在酒店详情页点击"立即预订"
2. 验证显示预订表单（步骤 1）
3. 从下拉列表选择一个差旅申请
4. 点击"下一步"

#### 步骤 2: 填写客人信息
1. 验证显示客人信息表单
2. 填写必填字段：
   - **名字**: John
   - **姓氏**: Doe
   - **邮箱**: john.doe@example.com
   - **电话**: （可选）
3. 如果需要多个客人，点击"添加客人"
4. 填写特殊要求（可选）
5. 点击"下一步"

#### 步骤 3: 确认预订
1. 验证显示预订确认信息：
   - 酒店信息
   - 价格
   - 日期
   - 客人数量
2. 检查所有信息是否正确
3. 点击"提交预订"
4. 等待提交完成
5. 验证：
   - 显示成功通知
   - 跳转到预订管理页（或显示预订详情）

### 6. 验证数据库数据

使用 MongoDB 客户端或脚本验证：

```javascript
// 查询最新创建的酒店预订
db.hotelbookings.find().sort({ createdAt: -1 }).limit(1).pretty()

// 验证字段：
// ✅ travelId: ObjectId（关联差旅申请）
// ✅ employee: ObjectId（当前用户）
// ✅ guests: 数组，格式正确
//   - id: "GUEST_1"
//   - name: { firstName: "John", lastName: "Doe" }
//   - contact: { emailAddress: "john.doe@example.com", phones: [...] }
// ✅ hotelOffer: 完整对象
// ✅ offerId: String
// ✅ checkIn: Date
// ✅ checkOut: Date
// ✅ price: { total, currency, base, taxes }
// ✅ status: "confirmed"
```

### 7. 验证差旅申请更新

```javascript
// 查询关联的差旅申请
db.travels.findOne({ _id: ObjectId("差旅申请ID") })

// 验证：
// ✅ bookings 数组中包含新预订
// ✅ bookings[].type === "hotel"
// ✅ bookings[].hotelBookingId 指向新创建的预订
// ✅ estimatedCost 已更新（包含酒店费用）
```

## 测试检查清单

### 功能测试
- [ ] Tab 切换功能正常
- [ ] 酒店搜索功能正常
- [ ] 酒店列表显示正常
- [ ] 酒店详情页正常
- [ ] 预订表单三步流程正常
- [ ] 差旅申请选择正常
- [ ] 客人信息表单正常
- [ ] 预订提交成功

### 数据格式测试
- [ ] guests 数组格式符合数据库要求
- [ ] hotelOffer 是完整的报价对象
- [ ] offerId 正确传递
- [ ] travelId 必填验证
- [ ] 日期格式正确（YYYY-MM-DD）
- [ ] 邮箱格式验证
- [ ] 电话格式验证

### 集成测试
- [ ] 从差旅申请跳转到酒店搜索
- [ ] 预订成功后更新差旅申请
- [ ] 预订列表显示正确
- [ ] 预订详情显示正确

### 错误处理测试
- [ ] 搜索错误提示正确
- [ ] 表单验证错误提示正确
- [ ] API 错误处理正确
- [ ] 网络错误处理正确

## 常见问题排查

### 问题 1: Tab 切换后页面空白
**检查：**
- 浏览器控制台是否有错误
- 组件导入路径是否正确
- 路由配置是否正确

### 问题 2: 酒店搜索无结果
**检查：**
- 网络请求是否成功（浏览器 Network 标签）
- 城市代码是否正确（建议使用 NYC, PAR, LON 等）
- 后端日志是否有错误

### 问题 3: 预订提交失败
**检查：**
- 浏览器 Network 标签中的请求数据格式
- 后端日志错误信息
- 差旅申请状态是否允许（必须是 approved 或 draft）

### 问题 4: 权限错误
**检查：**
- 运行 `node backend/scripts/initRolePermissions.js`
- 检查用户角色权限
- 检查前端权限配置

## 测试数据示例

### 测试城市代码
- NYC - 纽约
- PAR - 巴黎
- LON - 伦敦
- TYO - 东京
- BJS - 北京

### 测试日期
- 入住日期：未来30天内的日期
- 退房日期：入住日期后1-7天

### 测试客人信息
```javascript
{
  name: {
    firstName: "John",
    lastName: "Doe"
  },
  contact: {
    emailAddress: "john.doe@example.com",
    phones: [{
      deviceType: "MOBILE",
      countryCallingCode: "+86",
      number: "13800138000"
    }]
  }
}
```

## 下一步

1. **手动测试**: 按照上述步骤进行完整的手动测试
2. **自动化测试**: 考虑添加 E2E 测试（如 Cypress）
3. **性能测试**: 测试大量数据下的性能
4. **兼容性测试**: 测试不同浏览器和设备

---

**文档版本**: 1.0  
**创建日期**: 2025-12-21  
**最后更新**: 2025-12-21

